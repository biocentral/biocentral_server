{
    admin off
    auto_https off
}


:80 {
    log {
        output stdout
        format console
    }

    handle /health {
        reverse_proxy {$API_BACKEND_URL}/health
    }

    # API routes - must be before static file serving
    # All {$ROOT_PATH}/* routes - strip {$ROOT_PATH} prefix entirely, forward to FastAPI root
    handle {$ROOT_PATH}/* {
        uri strip_prefix {$ROOT_PATH}
        reverse_proxy {$API_BACKEND_URL} 
    }


    handle /health {
        reverse_proxy {$API_BACKEND_URL}/health
    }



    # Serve static landing page at root
    handle {
        root * /var/www/assets
        try_files {path} /landing.html
        file_server
    }

    # Security headers
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}
